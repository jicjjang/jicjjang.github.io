{"componentChunkName":"component---src-templates-post-template-tsx","path":"/posts/dooray-bot-server","result":{"data":{"site":{"siteMetadata":{"title":"June"}},"markdownRemark":{"id":"31becaba-1ecb-5804-80ec-d9c5be0ad249","excerpt":"!!! 이 글은 사내 메신저인 Dooray에서 활용할 bot scheduler에 대한 소개로, 비정상적인 경로로의 접근은 하지 말아주시기 바랍니다. !!! Front 게시물에 이어서 바로 서버 사용법을 설명드리겠습니다. 일단 서버는 노드로 구현이되어있고,\n타이머를 돌면서…","html":"<h3 id=\"-이-글은-사내-메신저인-Dooray에서-활용할-bot-scheduler에-대한-소개로-비정상적인-경로로의-접근은-하지-말아주시기-바랍니다-\" style=\"position:relative;\">!!! 이 글은 사내 메신저인 Dooray에서 활용할 bot scheduler에 대한 소개로, 비정상적인 경로로의 접근은 하지 말아주시기 바랍니다. !!!<a href=\"#-%EC%9D%B4-%EA%B8%80%EC%9D%80-%EC%82%AC%EB%82%B4-%EB%A9%94%EC%8B%A0%EC%A0%80%EC%9D%B8-Dooray%EC%97%90%EC%84%9C-%ED%99%9C%EC%9A%A9%ED%95%A0-bot-scheduler%EC%97%90-%EB%8C%80%ED%95%9C-%EC%86%8C%EA%B0%9C%EB%A1%9C-%EB%B9%84%EC%A0%95%EC%83%81%EC%A0%81%EC%9D%B8-%EA%B2%BD%EB%A1%9C%EB%A1%9C%EC%9D%98-%EC%A0%91%EA%B7%BC%EC%9D%80-%ED%95%98%EC%A7%80-%EB%A7%90%EC%95%84%EC%A3%BC%EC%8B%9C%EA%B8%B0-%EB%B0%94%EB%9E%8D%EB%8B%88%EB%8B%A4-\" aria-label=\" 이 글은 사내 메신저인 Dooray에서 활용할 bot scheduler에 대한 소개로 비정상적인 경로로의 접근은 하지 말아주시기 바랍니다  permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<hr>\n<p>Front 게시물에 이어서 바로 서버 사용법을 설명드리겠습니다. 일단 서버는 노드로 구현이되어있고,\n타이머를 돌면서 1분마다 firebase를 찔러보며 hook time이 현재 시간과 일치하는 스케쥴의\n내용을 Dooray로 쏴줍니다.</p>\n<h1 id=\"1-Dooray-Hooker\" style=\"position:relative;\">1. <a href=\"https://github.com/jicjjang/DoorayHooker\">Dooray Hooker</a><a href=\"#1-Dooray-Hooker\" aria-label=\"1 Dooray Hooker permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>서버에서 사용하는 <a href=\"https://github.com/jicjjang/menubot\">menubot</a> 에서의 동작은 크게 3가지로 나뉩니다.</p>\n<ol>\n<li>이미지 자르기</li>\n<li>이미지 위치 구하기</li>\n<li>글자 인식</li>\n</ol>\n<p>이러한 동작을 위해 기본 세팅이 조금 필요합니다.</p>\n<h2 id=\"1-1-기본-세팅\" style=\"position:relative;\">1-1. 기본 세팅<a href=\"#1-1-%EA%B8%B0%EB%B3%B8-%EC%84%B8%ED%8C%85\" aria-label=\"1 1 기본 세팅 permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>우선 이미지를 자를 때 필요한 <a href=\"https://www.imagemagick.org/script/index.php\">imagemagick</a> 라이브러리 입니다.\nbrew로 간단하게 설치할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ brew <span class=\"token function\">install</span> imagemagick</code></pre></div>\n<p>그리고 이미지 인식에 사용할 <a href=\"https://cloud.google.com/sdk/docs/quickstart-mac-os-x\">google-vision</a>이 필요합니다.\n(구글 비전은 링크를 보시고 순서대로 실행해주세요)</p>\n<h2 id=\"1-2-설정-파일\" style=\"position:relative;\">1-2. 설정 파일<a href=\"#1-2-%EC%84%A4%EC%A0%95-%ED%8C%8C%EC%9D%BC\" aria-label=\"1 2 설정 파일 permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">git</span> clone https://github.com/jicjjang/DoorayHooker\n$ <span class=\"token builtin class-name\">cd</span> DoorayHooker\n$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> forever -g\n$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span>\n$ <span class=\"token function\">npm</span> run start</code></pre></div>\n<p>우선 npm을 설치하고 서버를 띄웁니다.\n이번에도 바로 에러가 뜹니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 480px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4bce599aa1f8e408468302fcd19db0f2/8efc2/error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfElEQVQoz0VSW1uCUBA8+pVmkpqiJVZvXazMEAFRUPCW/f8ftM3soc+H5ey5zO7MLKbpr6T2GUttEoszW8kl8sZXIlcIx+c+kup4Ls3vpZ6Z15mYF/8c3L8FNpgT0Aoy6S+24qUHceNC16f8JL04l26Uy2C5Ey87ynC1l36y1ff3yHnfmCbSnq81rtHUmGdfuw+SndwB2I02CiTgZpbqymYEe9lB37EJC7SC9MzunyE/BLoAjcDiNtwomMWVGdgyemCuKvCGTVmg+h7KxUdURqjWGfpAqmTCgixOWcz7i0LBLM6CLvbDlCy36m9HWWYaDnAdkDGVcSBtHFDK4+YkHNKgZNcJ17YwCtBbviFL7tmYalr0brqEBZmemQY27EQAu5I6p8mp1ycL5DbqE/snUA095x1zFqvjnsNRyY76V2Cqv5C215yeWWmlh2CpcmGLV5678Jl7V23JrQ1kWME/Rsks9rD+0QvKpORRZgdCgL0/6nQ5kAoDWLueJ/0HN1kNI2Cx8bYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"error\"\n        title=\"error\"\n        src=\"/static/4bce599aa1f8e408468302fcd19db0f2/e85cb/error.png\"\n        srcset=\"/static/4bce599aa1f8e408468302fcd19db0f2/070ae/error.png 120w,\n/static/4bce599aa1f8e408468302fcd19db0f2/8ff5a/error.png 240w,\n/static/4bce599aa1f8e408468302fcd19db0f2/e85cb/error.png 480w,\n/static/4bce599aa1f8e408468302fcd19db0f2/37523/error.png 720w,\n/static/4bce599aa1f8e408468302fcd19db0f2/8efc2/error.png 828w\"\n        sizes=\"(max-width: 480px) 100vw, 480px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>다시 <code class=\"language-text\">&quot;ex.config.js&quot;</code> 파일을 참고하여 <code class=\"language-text\">&quot;config.js&quot;</code> 파일을 만듭니다.</p>\n<h4 id=\"그리고-메뉴-이미지를-넣어줍니다-메뉴봇을-이용할-때-기본적으로-imgall_menumenupng-경로로-저장된-이미지를-사용하도록-해놨습니다-해당-경로로-식사메뉴-이미지를-다운받아서-해당-경로로-넣어줍니다\" style=\"position:relative;\">그리고 메뉴 이미지를 넣어줍니다. 메뉴봇을 이용할 때, 기본적으로 \"img/all_menu/menu.png\" 경로로 저장된 이미지를 사용하도록 해놨습니다. 해당 경로로 식사메뉴 이미지를 다운받아서 해당 경로로 넣어줍니다.<a href=\"#%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EB%A9%94%EB%89%B4-%EC%9D%B4%EB%AF%B8%EC%A7%80%EB%A5%BC-%EB%84%A3%EC%96%B4%EC%A4%8D%EB%8B%88%EB%8B%A4-%EB%A9%94%EB%89%B4%EB%B4%87%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%A0-%EB%95%8C-%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9C%BC%EB%A1%9C-imgall_menumenupng-%EA%B2%BD%EB%A1%9C%EB%A1%9C-%EC%A0%80%EC%9E%A5%EB%90%9C-%EC%9D%B4%EB%AF%B8%EC%A7%80%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8F%84%EB%A1%9D-%ED%95%B4%EB%86%A8%EC%8A%B5%EB%8B%88%EB%8B%A4-%ED%95%B4%EB%8B%B9-%EA%B2%BD%EB%A1%9C%EB%A1%9C-%EC%8B%9D%EC%82%AC%EB%A9%94%EB%89%B4-%EC%9D%B4%EB%AF%B8%EC%A7%80%EB%A5%BC-%EB%8B%A4%EC%9A%B4%EB%B0%9B%EC%95%84%EC%84%9C-%ED%95%B4%EB%8B%B9-%EA%B2%BD%EB%A1%9C%EB%A1%9C-%EB%84%A3%EC%96%B4%EC%A4%8D%EB%8B%88%EB%8B%A4\" aria-label=\"그리고 메뉴 이미지를 넣어줍니다 메뉴봇을 이용할 때 기본적으로 imgall_menumenupng 경로로 저장된 이미지를 사용하도록 해놨습니다 해당 경로로 식사메뉴 이미지를 다운받아서 해당 경로로 넣어줍니다 permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h4>\n<h2 id=\"1-3-사용\" style=\"position:relative;\">1-3. 사용<a href=\"#1-3-%EC%82%AC%EC%9A%A9\" aria-label=\"1 3 사용 permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>서버에서는 기본 세팅이 복잡하고, 사용에 대해선 큰 어려움이 없습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> run start</code></pre></div>\n<p>서버를 시작해주시면 됩니다. <a href=\"https://www.npmjs.com/package/forever\">forever</a>를 사용하였기 때문에\n서버가 시작되면</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ forever list</code></pre></div>\n<p>명령어로 현재 서버에 대한 로그파일을 확인하실 수 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 480px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2d3021ea8cca0929d2ea9862407556de/afa26/log1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 11.666666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAgElEQVQI112OzQqCQAAGF7TCVVPIZ8iFrNwfdN0siPLQ+z/QtHnsMAzfZfhEoS3peaSwdw7Tkzxa6ht7N1OFD4lZSM2b1P5Y2NgXpdNUrqPxnto9kP1EdvHkakBk7UiiHLsuRvuAOJqVvLsiI0LF3f5jV5dmjrFAEQ9sTwO18nwBG+Q5I9hrSGcAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"log1\"\n        title=\"log1\"\n        src=\"/static/2d3021ea8cca0929d2ea9862407556de/e85cb/log1.png\"\n        srcset=\"/static/2d3021ea8cca0929d2ea9862407556de/070ae/log1.png 120w,\n/static/2d3021ea8cca0929d2ea9862407556de/8ff5a/log1.png 240w,\n/static/2d3021ea8cca0929d2ea9862407556de/e85cb/log1.png 480w,\n/static/2d3021ea8cca0929d2ea9862407556de/37523/log1.png 720w,\n/static/2d3021ea8cca0929d2ea9862407556de/d9199/log1.png 960w,\n/static/2d3021ea8cca0929d2ea9862407556de/afa26/log1.png 1258w\"\n        sizes=\"(max-width: 480px) 100vw, 480px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 480px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5b0b96748be1776463d48db36f8f77d4/9cea8/log2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 25.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA9ElEQVQY02WQS2+CQBDHkca0PgIKKPFgPAKmirIoDwWfTZu2B41fobc+vv/t78yKJNrDL7Mz2f3NzCp28oJB/o7e8hX95Rs4N8QaRrqHdfgmfqF9Mj9ofvyhc/jC+OhAnAawFz5UL8LTOEZ9ksqoWMkWZryBne7QmC6ghzna8xWxhkZnTWSypg5DKE4AxRVEcMERl1pBxaPcjDYw6XEn3qLmJ9CCDBbVLGrSIpEeZjKWQucqKnALqK56dKdLE7KAJ6z7KXSRS1k32cGgRu3ZSsaH4ez/hG5wI6ywsEG7M01al/+Ap3wcRag+M/OS66NScE8hPAN6kZIxPudLfwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"log2\"\n        title=\"log2\"\n        src=\"/static/5b0b96748be1776463d48db36f8f77d4/e85cb/log2.png\"\n        srcset=\"/static/5b0b96748be1776463d48db36f8f77d4/070ae/log2.png 120w,\n/static/5b0b96748be1776463d48db36f8f77d4/8ff5a/log2.png 240w,\n/static/5b0b96748be1776463d48db36f8f77d4/e85cb/log2.png 480w,\n/static/5b0b96748be1776463d48db36f8f77d4/37523/log2.png 720w,\n/static/5b0b96748be1776463d48db36f8f77d4/d9199/log2.png 960w,\n/static/5b0b96748be1776463d48db36f8f77d4/9cea8/log2.png 1278w\"\n        sizes=\"(max-width: 480px) 100vw, 480px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>등록되어있는 스케쥴들이 정상적으로 봇으로 동작하는 모습을 보실 수 있습니다!</p>\n<hr>\n<p>봇을 만든것에 대한 경험 공유는 여기까지 입니다.\n사용하시면서 어려우실 만한 부분은 google vision의 설치일 것 같네요... (저도 꽤나 오래 걸렸습니다...)</p>\n<p>감사합니다.</p>","frontmatter":{"title":"Dooray bot scheduler (Server)","date":"June 27, 2017","tags":["dooray","bot","nhn"]}}},"pageContext":{"slug":"/posts/dooray-bot-server","previous":{"fields":{"slug":"/posts/dooray-bot-front"},"frontmatter":{"title":"Dooray bot scheduler (Front)"}},"next":{"fields":{"slug":"/posts/jwt"},"frontmatter":{"title":"Would you mind using a JWT?"}}}}}