{"componentChunkName":"component---src-templates-post-template-tsx","path":"/posts/i18next","result":{"data":{"site":{"siteMetadata":{"title":"June"}},"markdownRemark":{"id":"9af9d770-51d6-563e-914a-cb7ba9eb4e6a","excerpt":"사실 레퍼런스도 많고 다국어 적용 시 필수적으로 사용하는 는 이미 알려질대로 알려진 유명 라이브러리지만, 실제로 사용해 본 경험은 없습니다.\nglobally…","html":"<p>사실 레퍼런스도 많고 다국어 적용 시 필수적으로 사용하는 <a href=\"https://www.i18next.com/\" target=\"_blank\" rel=\"noopener\"><code class=\"language-text\">i18next</code></a>는 이미 알려질대로 알려진 유명 라이브러리지만, 실제로 사용해 본 경험은 없습니다.\nglobally한 개인 프로젝트를 해본적이 없었고, 라인플러스에 재직 시에는 사내 다국어 대응 라이브러리인 <code class=\"language-text\">XLT</code>를 사용했기 때문에 <code class=\"language-text\">i18next</code>를 실제로 사용해 볼 기회가 마땅치 않았습니다.</p>\n<p>마침 회사에서 사용해볼 기회가 있었는데요. lerna monorepo 환경으로 여러 프로젝트와 여러 라이브러리들이 있는데, 전체적으로 한번에 적용하는 상황이었습니다.\n프로젝트가 라이브러리들을 사용하기도 하고, 프로젝트가 다른 프로젝트 파일을 가져오기도 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">project\n ㄴ packages\n    ㄴ project1 <span class=\"token comment\">// library1, library2를 사용</span>\n    ㄴ project2 <span class=\"token comment\">// project1, library1, library2를 사용</span>\n    ㄴ library1 <span class=\"token comment\">// 다른 라이브러리 사용하지 않음</span>\n    ㄴ library2 <span class=\"token comment\">// 다른 라이브러리 사용하지 않음</span>\n    ㄴ <span class=\"token operator\">...</span></code></pre></div>\n<p>처음 적용했던건 project1이었고, project1에서 가이드에 맞춰 i18next, react-i18next 라이브러리를 추가해 작업을 진행하였습니다.</p>\n<hr>\n<h3 id=\"i18next-설정\" style=\"position:relative;\">i18next 설정<a href=\"#i18next-%EC%84%A4%EC%A0%95\" aria-label=\"i18next 설정 permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>우선 i18next를 설정해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> i18n <span class=\"token keyword\">from</span> <span class=\"token string\">'i18next'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> LanguageDetector <span class=\"token keyword\">from</span> <span class=\"token string\">'i18next-browser-languagedetector'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> initReactI18next <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react-i18next'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> en <span class=\"token keyword\">from</span> <span class=\"token string\">'./en.json'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> ko <span class=\"token keyword\">from</span> <span class=\"token string\">'./ko.json'</span><span class=\"token punctuation\">;</span>\n\ni18n\n  <span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>initReactI18next<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span>LanguageDetector<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    resources<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      en<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">namespace</span><span class=\"token operator\">:</span> en<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      ko<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">namespace</span><span class=\"token operator\">:</span> ko<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    debug<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    ns<span class=\"token operator\">:</span> <span class=\"token string\">'namespace'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// resources에 들어갈 namespace 이름</span>\n    defaultNS<span class=\"token operator\">:</span> <span class=\"token string\">'namespace'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 여러 namespace가 있을 수 있는데, 기본으로 사용할 namespace</span>\n    keySeparator<span class=\"token operator\">:</span> <span class=\"token string\">'.'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 번역 파일을 {} 형식으로 구성하고 keySaparator를 통해 접근이 가능</span>\n    interpolation<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      escapeValue<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// xss 취약점을 막아주는 옵션으로 기본 true이나, 번역을 통해 html 태그가 들어갈 수 있음</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// i18n-scanner plural 키 지원</span>\n    <span class=\"token comment\">// https://github.com/i18next/i18next-scanner/issues/228#issuecomment-1169740402</span>\n    compatibilityJSON<span class=\"token operator\">:</span> <span class=\"token string\">'v3'</span><span class=\"token punctuation\">,</span>\n    react<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      bindI18n<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// prevent react-i18next rerender</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> i18n<span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">.use()</code> 형식은 express의 middleware와 동일합니다.\n브라우저의 언어를 인식할 수 있도록 <code class=\"language-text\">i18next-browser-languagedetector 라이브러리의 LanguageDetector</code> 를 추가했고, react의 hooks을 사용하기 위한 <code class=\"language-text\">react-i18next</code> 라이브러리도 추가했습니다. 그리고 <code class=\"language-text\">i18next.ts</code>파일을 next.js의 시작점인 <code class=\"language-text\">_app.tsx</code>에서 호출하도록 설정해줍니다.</p>\n<p>이제 번역이 필요한 text들에 대해 i18next를 적용해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// tsx file</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> t <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useTranslation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CustomError</span></span>\n      <span class=\"token attr-name\">statusCode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>500<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">title</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">t</span><span class=\"token punctuation\">(</span><span class=\"token string\">'500Error'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Something went wrong...'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 기본값 포함</span>\n\n<span class=\"token comment\">// en.json</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"500Error\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Something went wrong...\"</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// ko.json</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"500Error\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"서버에 문제가...\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">react-i18next</code>를 사용했기 때문에 useTransloation 을 사용했지만, <code class=\"language-text\">&lt;Trans&gt;</code> 태그를 사용할수도 있습니다.</p>\n<p>이제 한국어, 영어를 토글할 수 있도록 설정이 필요합니다.\n<code class=\"language-text\">i18next-browser-languagedetector 라이브러리의 LanguageDetector</code>는 브라우저의 언어를 확인해주는데,\ncookie, 브라우저 스토리지들, query string, path 등등의 미리 정의된 키값에 언어값을 넣으면 해당 언어를 통해\n브라우저의 언어가 바뀌었다는걸 판단하고 업데이트 해줍니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 480px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9f1063b42817b0445de590a2baa9cbba/9a46a/i18next-browser-languagedetector-introduction.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHasVwJD//EABUQAQEAAAAAAAAAAAAAAAAAACAx/9oACAEBAAEFAov/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAYEAADAQEAAAAAAAAAAAAAAAAAAREQMf/aAAgBAQABPyG04KvH0Wf/2gAMAwEAAgADAAAAEMsP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAAICAwAAAAAAAAAAAAAAAQAREDEhQWH/2gAIAQEAAT8QBWW3tjC7DyF9sBbg3NDH/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"i18next-browser-languagedetector-introduction\"\n        title=\"i18next-browser-languagedetector-introduction\"\n        src=\"/static/9f1063b42817b0445de590a2baa9cbba/7cc5e/i18next-browser-languagedetector-introduction.jpg\"\n        srcset=\"/static/9f1063b42817b0445de590a2baa9cbba/e439a/i18next-browser-languagedetector-introduction.jpg 120w,\n/static/9f1063b42817b0445de590a2baa9cbba/09b79/i18next-browser-languagedetector-introduction.jpg 240w,\n/static/9f1063b42817b0445de590a2baa9cbba/7cc5e/i18next-browser-languagedetector-introduction.jpg 480w,\n/static/9f1063b42817b0445de590a2baa9cbba/80e3c/i18next-browser-languagedetector-introduction.jpg 720w,\n/static/9f1063b42817b0445de590a2baa9cbba/6a068/i18next-browser-languagedetector-introduction.jpg 960w,\n/static/9f1063b42817b0445de590a2baa9cbba/9a46a/i18next-browser-languagedetector-introduction.jpg 1592w\"\n        sizes=\"(max-width: 480px) 100vw, 480px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>창이 닫혀도 언어가 바뀌는걸 원치 않으니 localStorage의 <code class=\"language-text\">i18nextLng</code> 키에 특정 버튼을 토글하면 언어가 <code class=\"language-text\">en</code>, <code class=\"language-text\">ko</code>로 바뀌도록 설정해줍니다.</p>\n<hr>\n<h3 id=\"react-i18next-제거\" style=\"position:relative;\">react-i18next 제거<a href=\"#react-i18next-%EC%A0%9C%EA%B1%B0\" aria-label=\"react i18next 제거 permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>next.js를 사용하고 있지만, api에서 내려오는 text는 서버에서 직접 번역에서 내려주기 때문에 SSR 시점에 별도로 다국어를 지원하는 부분은 없어서 react-i18next로 결정을 했습니다.\nSSR 시점에도 다국어 지원이 필요하다면 <code class=\"language-text\">next-i18next</code>를 사용할수 있습니다.</p>\n<p>그런데, 제가 사용한 <code class=\"language-text\">react-i18next</code> 라이브러리는 hooks나 jsx 태그 형식을 차용하기 때문에 언어를 바꿨을 때 바로 rerender가 발생하며 텍스트들이 변환되었습니다.\n문제는 api응답으로 내려받아 넣은 text들은 업데이트가 되지 않는 점이었는데요, 이 문제는 팀 내 의견을 통해 언어 토글 시 새로고침이 되도록 수정되었습니다.\n하지만 0.3~0.5초 정도 언어가 토글이 되는게 보이면서 새로고침이 발생하였습니다.</p>\n<p>따라서 <code class=\"language-text\">react-i18next</code>를 제거하고 <code class=\"language-text\">i18next</code> 만을 사용해 아래와 같은 형식으로 텍스트가 들어가도록 수정하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> t <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useTranslation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CustomError</span></span>\n      <span class=\"token attr-name\">statusCode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>500<span class=\"token punctuation\">\"</span></span>\n      <span class=\"token attr-name\">title</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>i18next<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">t</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'500Error'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Something went wrong...'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p><code class=\"language-text\">i18next</code> 만을 사용하면 동적인 업데이트는 없었고, 새로고침 전 일부 언어가 바뀌어 깜빡이는 현상이 없어졌습니다.</p>\n<hr>\n<h3 id=\"모노레포-이슈\" style=\"position:relative;\">모노레포 이슈<a href=\"#%EB%AA%A8%EB%85%B8%EB%A0%88%ED%8F%AC-%EC%9D%B4%EC%8A%88\" aria-label=\"모노레포 이슈 permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>library1, library2로 접근하여 여러 프로젝트에서 공통으로 사용하는 파일을 접근하였는데,\nproject1의 경로를 벗어나 접근한 library의 파일들은 번역이 되지 않았습니다.</p>\n<p>다행히 library1, library2는 파일을 export 할 때, 모든 디렉토리마다 index.ts를 두고 같은 디렉토리의 모든 파일을 모아 상위로 보내주는 방식이었습니다.\n트리쉐이킹을 위해 이와 같은 구조를 만들었던 것이죠.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// index.ts</span>\n<span class=\"token keyword\">export</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./Button'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./Carousel'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./Checkbox'</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<p>그래서 project1의 i18next.ts 파일을 library1, library2에도 만들어주고 index.ts 최 상단에서 i18next.ts 파일을 한번 불러올 수 있게 추가하였습니다.\n이제서야 잘 동작하게 되었고, <code class=\"language-text\">i18next.ts 파일을 통해 i18next를 실행했을 때, 프로젝트 보다 상위 경로를 통해 다른 프로젝트 파일에 접근하면 i18next가 동작하지 않는다</code> 는 것을 알 수 있었습니다.</p>\n<p>이렇게 되면 문제는 project2에서 project1을 접근할 때 였습니다.\nproject1에서는 library들만 접근하였고, library들에서는 트리쉐이킹을 위해 모든 하위 모듈들을 상위로 export 해주었지만,\nproject1은 말 그대로 프로젝트였기 때문에 이러한 처리가 없었습니다.</p>\n<p>우선 project2에 대한 고민은 뒤로 미뤄놓고 진행해보겠습니다.</p>\n<hr>\n<h3 id=\"i18next-scanner\" style=\"position:relative;\">i18next-scanner<a href=\"#i18next-scanner\" aria-label=\"i18next scanner permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>전체 설정이 다 끝났으나, 프로젝트와 라이브러리에 text를 변환해주는 작업은... 정말 노가다였습니다.\n2주정도의 노가다 작업을 통해 i18next 설정을 끝냈는데, 여기서 키값과 기본값 등을 뽑아내는게 여간 번거로운게 아니었습니다.</p>\n<p>이를 위해 i18next-scanner라는 라이브러리를 알아보라고 팀원에게 도움을 받았습니다.\n이 라이브러리는 프로젝트에 설정된 부분들을 전체 검색해서 키, 기본값을 가져와 json 파일에 자동으로 넣어주는 역할을 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// i18n-scanner.js</span>\n<span class=\"token keyword\">const</span> i18nScannerConfig <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[공통 config path]/i18n-scanner.config'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> tsconfig <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./tsconfig.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token function\">i18nScannerConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  tsconfig<span class=\"token punctuation\">,</span>\n  resourcePath<span class=\"token operator\">:</span> <span class=\"token string\">'locales/{{lng}}.json'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>우선 프로젝트, 라이브러리마다 설정파일을 만들어줍니다.\n라이브러리에서도 각각의 i18next.ts를 통해 i18next 번역을 해줘야 하니, i18n-scanner.js 파일도 개별로 가지고 있어야 합니다.</p>\n<p>monorepo의 여러 package가 비슷한 i18n-scanner 파일을 가지므로 <code class=\"language-text\">i18nScannerConfig</code> 라는 공용 config을 만들어서\n각 프로젝트, 라이브러리의 i18n-scanner.js 파일을 가볍게 만들어줬습니다.</p>\n<p>물론 이 공용 config 파일은 무겁습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// i18n-scanner.config.js</span>\n<span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> typescript <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'typescript'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">config</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  input<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'src/**/*.{js,jsx,ts,tsx}'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// !는 필터링</span>\n    <span class=\"token string\">'!src/**/*.d.{js,jsx,ts,tsx}'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'!src/**/*.spec.{js,jsx,ts,tsx}'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'!i18next.ts'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'!node_modules/**'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  output<span class=\"token operator\">:</span> <span class=\"token string\">'./'</span><span class=\"token punctuation\">,</span>\n  options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    debug<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    sort<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    ns<span class=\"token operator\">:</span> <span class=\"token string\">'common'</span><span class=\"token punctuation\">,</span>\n    defaultNS<span class=\"token operator\">:</span> <span class=\"token string\">'common'</span><span class=\"token punctuation\">,</span>\n    keySeparator<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    removeUnusedKeys<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    lngs<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'ko'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'en'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    defaultLng<span class=\"token operator\">:</span> <span class=\"token string\">'en'</span><span class=\"token punctuation\">,</span>\n    defaultValue<span class=\"token operator\">:</span> <span class=\"token string\">'__EMPTY__'</span><span class=\"token punctuation\">,</span>\n    resource<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      loadPath<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>resourcePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      savePath<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>resourcePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      jsonIndent<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n      lineEnding<span class=\"token operator\">:</span> <span class=\"token string\">'\\n'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">transform</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token function\">transform</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file<span class=\"token punctuation\">,</span> enc<span class=\"token punctuation\">,</span> done</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> extensions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'.ts'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.tsx'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> extension <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">extname</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 타입스크립트 컴파일</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">.</span>extensions<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span>extension<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> parser <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parser<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> tsFile <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">,</span> enc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> tsFileToString <span class=\"token operator\">=</span> typescript<span class=\"token punctuation\">.</span><span class=\"token function\">transpileModule</span><span class=\"token punctuation\">(</span>tsFile<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>config<span class=\"token punctuation\">.</span>tsconfig<span class=\"token punctuation\">,</span>\n        fileName<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">basename</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>outputText<span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// &lt;Trans ... 파싱</span>\n      parser<span class=\"token punctuation\">.</span><span class=\"token function\">parseTransFromString</span><span class=\"token punctuation\">(</span>tsFileToString<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        component<span class=\"token operator\">:</span> <span class=\"token string\">'Trans'</span><span class=\"token punctuation\">,</span>\n        i18nKey<span class=\"token operator\">:</span> <span class=\"token string\">'i18nKey'</span><span class=\"token punctuation\">,</span>\n        extensions<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'.ts'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.tsx'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// 아래 함수들 파싱 (커스텀한 이름을 쓰려면 바꿔줘야 함)</span>\n      parser<span class=\"token punctuation\">.</span><span class=\"token function\">parseFuncFromString</span><span class=\"token punctuation\">(</span>tsFileToString<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        list<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'i18next.t'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'i18n.t'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'t'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'_t'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이후 monorepo에서 모든 프로젝트의 script를 실행할 수 있도록 root package.json에 <code class=\"language-text\">&quot;i18next-scan&quot;: &quot;lerna run i18next-scan&quot;</code>이라는\n스크립트를 만들고 각 프로젝트의 package.json에서 <code class=\"language-text\">&quot;i18next-scan&quot;: &quot;i18next-scanner --config ./[각 프로젝트의 경로]/i18n-scanner.js&quot;</code> 를\n설정한 뒤 실행합니다.</p>\n<p>기본값들이 추가된 en.json, ko.json이 각 프로젝트의 지정 경로마다 생성되었습니다. 기본값이 없을 때 들어가는 <code class=\"language-text\">__EMPTY__</code> 이 있는 키값은 없는지 확인합니다.</p>\n<p><code class=\"language-text\">i18next-scan</code>은 귀찮겠지만 텍스트가 추가될 때마다 실행하고 업데이트가 필요합니다.</p>\n<hr>\n<p>이렇게 1차적인 작업이 완료되었으나, 팀 내에서 react-i18next를 사용하자는 의견이 추가적으로 나왔습니다.</p>\n<p><code class=\"language-text\">&lt;Trans&gt;</code>태그는 <code class=\"language-text\">It does ONLY interpolation. It does not rerender on language change or load any translations needed. Check useTranslation hook or withTranslation HOC for those cases.</code> 라고 기재되어 있었기 때문에 이것만 사용하자는 것이었죠.</p>\n<p>또한, 아래와 같은 옵션 추가로 hooks를 사용하더라도 rerender가 발생하지 않는다는 것이었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\">  <span class=\"token comment\">// 이미 최상위 i18next.ts에서도 보여드렸습니다.</span>\n  <span class=\"token operator\">...</span>\n  react<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    bindI18n<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// prevent react-i18next rerender</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token operator\">...</span></code></pre></div>\n<p>확인해보니 리렌더가 발생하지 않았고, 기존에 없앴던걸 후회했습니다... ㅠㅠ</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 480px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e0344f4f46a54ef83578f4510a90da63/cd851/bindI18n.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAEABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB35Cgf//EABYQAQEBAAAAAAAAAAAAAAAAAAABMf/aAAgBAQABBQJcf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABYQAQEBAAAAAAAAAAAAAAAAABEAEP/aAAgBAQABPyEwL//aAAwDAQACAAMAAAAQcA//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAXEAEBAQEAAAAAAAAAAAAAAAARAQAx/9oACAEBAAE/EAGgyCTu/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"bindI18n\"\n        title=\"bindI18n\"\n        src=\"/static/e0344f4f46a54ef83578f4510a90da63/7cc5e/bindI18n.jpg\"\n        srcset=\"/static/e0344f4f46a54ef83578f4510a90da63/e439a/bindI18n.jpg 120w,\n/static/e0344f4f46a54ef83578f4510a90da63/09b79/bindI18n.jpg 240w,\n/static/e0344f4f46a54ef83578f4510a90da63/7cc5e/bindI18n.jpg 480w,\n/static/e0344f4f46a54ef83578f4510a90da63/80e3c/bindI18n.jpg 720w,\n/static/e0344f4f46a54ef83578f4510a90da63/6a068/bindI18n.jpg 960w,\n/static/e0344f4f46a54ef83578f4510a90da63/cd851/bindI18n.jpg 2478w\"\n        sizes=\"(max-width: 480px) 100vw, 480px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>이렇게 다시 react-i18next도 사용할 수 있게 되었습니다.</p>\n<hr>\n<p>i18next를 적용한 내용은 여기까지 입니다.\ni18next config가 프로젝트 상위 경로를 넘어가면 다국어 적용이 안되고, react-i18next의 bindI18n 설정을 통해 rerender를 막을 수 있다는...\n경험을 할 수 있었습니다.</p>\n<p>project2에서 발생한 문제는 어떻게 해결하면 좋을지 아직 이슈 해결이 되지 않아 감이 잡히지 않습니다만 다음 포스팅에서 진행해보겠습니다.</p>","frontmatter":{"title":"i18next in react","date":"September 14, 2022","tags":["i18next","react-i18next"]}}},"pageContext":{"slug":"/posts/i18next","previous":{"fields":{"slug":"/posts/new-jobs3"},"frontmatter":{"title":"이직기 3"}},"next":{"fields":{"slug":"/posts/recoil-duplicated-key"},"frontmatter":{"title":"Recoil duplicate key error"}}}},"staticQueryHashes":["1576648375","1963346411"]}