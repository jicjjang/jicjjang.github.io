{"componentChunkName":"component---src-templates-post-template-tsx","path":"/posts/next-redux-wrapper-settings","result":{"data":{"site":{"siteMetadata":{"title":"June"}},"markdownRemark":{"id":"88b40f99-c6af-5d75-8b8e-4d76e4e9ffed","excerpt":"next.js를 처음 사용하며 store를 설정해보게 되었습니다. 심지어 redux도 2016년 이후로 처음 사용하며 (그동안 mobx, mobx-state-tree를 열심히 썼었죠) 공부를 해야했기 때문에 새로운 모듈을\n동시다발적으로 많이 추가하게 되었습니다.\nredux-saga…","html":"<p>next.js를 처음 사용하며 store를 설정해보게 되었습니다.</p>\n<p>심지어 redux도 2016년 이후로 처음 사용하며 (그동안 mobx, mobx-state-tree를 열심히 썼었죠) 공부를 해야했기 때문에 새로운 모듈을\n동시다발적으로 많이 추가하게 되었습니다.\nredux-saga, redux-observable (둘 중 비동기 라이브러리를 어떤걸 쓰느냐 결정하기 위해 PoC를 진행하며 모두 공부해야 했습니다), next-redux-wrapper, redux-saga-test-plan...</p>\n<hr>\n<p>얼마 전, <a href=\"/posts/next-redux-wrapper\">next-redux-wrapper 에서의 redux-observable 이슈</a>를 공유드리면서\nnext-redux-wrapper가 next.js에서 해결하려고 했던 부분에 대해 간략히 설명을 드렸었습니다.</p>\n<p>바로 <code class=\"language-text\">SSR에서 fetch한 데이터를 store에 저장하고, 이를 client와 공유하는 부분</code>이었죠.</p>\n<p>오늘도 열심히 개발을 하다가! 바로 <a href=\"https://github.com/vercel/next.js/discussions/15954\" target=\"_blank\" rel=\"noopener\">next-redux-wrapper에서 당황스러운 이슈</a>에 맞닿게 되었습니다.</p>\n<p>(뜬금없지만?! 전 카카오페이에 입사한 이후로 자바스크립트로 프로젝트를 한 경험이 딱 한번 있네요.\n물론 이번에도 팀원들에게 열심히 <a href=\"/posts/why-typescript\">typescript를 전파</a>하였고 (typescript를 쓰지 않고 계셨습니다.) webpack도 직접 다 설정 하는 등, 많은 노력을 기울였습니다.)</p>\n<h2 id=\"설정\" style=\"position:relative;\">설정<a href=\"#%EC%84%A4%EC%A0%95\" aria-label=\"설정 permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>이 이슈는 제가 typescript를 사용하면서 root store에서 타입을 정의하기 위해 꼼수를 부리다 생긴 이슈였는데요.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>createStore<span class=\"token punctuation\">,</span> applyMiddleware<span class=\"token punctuation\">,</span> Store<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>MakeStore<span class=\"token punctuation\">,</span> createWrapper<span class=\"token punctuation\">,</span> Context<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'next-redux-wrapper'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> createSagaMiddleware<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>Task<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'redux-saga'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> reducer<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>State<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./reducer'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> rootSaga <span class=\"token keyword\">from</span> <span class=\"token string\">'./saga'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">SagaStore</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Store</span> <span class=\"token punctuation\">{</span>\n  sagaTask<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Task<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> makeStore<span class=\"token operator\">:</span> MakeStore<span class=\"token operator\">&lt;</span>State<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>context<span class=\"token operator\">:</span> Context<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 1: Create the middleware</span>\n  <span class=\"token keyword\">const</span> sagaMiddleware <span class=\"token operator\">=</span> <span class=\"token function\">createSagaMiddleware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 2: Add an extra parameter for applying middleware:</span>\n  <span class=\"token keyword\">const</span> store <span class=\"token operator\">=</span> <span class=\"token function\">createStore</span><span class=\"token punctuation\">(</span>reducer<span class=\"token punctuation\">,</span> <span class=\"token function\">applyMiddleware</span><span class=\"token punctuation\">(</span>sagaMiddleware<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 3: Run your sagas on server</span>\n  <span class=\"token punctuation\">(</span>store <span class=\"token keyword\">as</span> SagaStore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sagaTask <span class=\"token operator\">=</span> sagaMiddleware<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>rootSaga<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// 4: now return the store:</span>\n  <span class=\"token keyword\">return</span> store<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> wrapper <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createWrapper</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>State<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>makeStore<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>debug<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>위 코드가 <a href=\"https://github.com/kirill-konshin/next-redux-wrapper#usage-with-redux-saga\" target=\"_blank\" rel=\"noopener\">next-redux-wrapper와 redux-saga를 함께 사용할 때의 root store설정 방법</a>입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">IAppDispatch</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> rootStore<span class=\"token punctuation\">.</span>dispatch<span class=\"token punctuation\">;</span></code></pre></div>\n<p>하지만 저는 위와 같이 rootStore의 dispatch값을 타입으로 정의하고 싶었습니다. makeStore에 감싸져 있는 store는 따로 타입으로 정의할 수 없었습니다.</p>\n<p>그래서 아래와 같이 store를 조각조각내어 사용하게 되었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token operator\">...</span>\n<span class=\"token keyword\">const</span> sagaMiddleware <span class=\"token operator\">=</span> <span class=\"token function\">createSagaMiddleware</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// dispatch 타입 정의를 위해 setupStore에서 바깥으로 빼냄</span>\n<span class=\"token keyword\">const</span> rootStore <span class=\"token operator\">=</span> <span class=\"token function\">configureStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  reducer<span class=\"token operator\">:</span> rootReducer<span class=\"token punctuation\">,</span>\n  middleware<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    sagaMiddleware<span class=\"token punctuation\">,</span>\n    <span class=\"token function\">createLogger</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// in development</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  devTools<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> setupStore<span class=\"token operator\">:</span> MakeStore<span class=\"token operator\">&lt;</span>IRootState<span class=\"token punctuation\">,</span> IRootAction<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">(</span>rootStore <span class=\"token keyword\">as</span> SagaStore<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>sagaTask <span class=\"token operator\">=</span> sagaMiddleware<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span>rootSaga<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> rootStore<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> makeStore<span class=\"token operator\">:</span> MakeStore<span class=\"token operator\">&lt;</span>IRootState<span class=\"token punctuation\">,</span> IRootAction<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setupStore</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> nextReduxWrapper <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">createWrapper</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>IRootState<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>makeStore<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  debug<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// in development</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">IAppDispatch</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> rootStore<span class=\"token punctuation\">.</span>dispatch<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> nextReduxWrapper<span class=\"token punctuation\">;</span></code></pre></div>\n<p>당연히 문제는 없어 보입니다. 하나의 함수로 되어있던 root store를 그저 쪼개기만 했으니까요.</p>\n<hr>\n<h2 id=\"이슈\" style=\"position:relative;\">이슈<a href=\"#%EC%9D%B4%EC%8A%88\" aria-label=\"이슈 permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<h3 id=\"1-원인\" style=\"position:relative;\">1. 원인<a href=\"#1-%EC%9B%90%EC%9D%B8\" aria-label=\"1 원인 permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>왜 그동안 아무도 이런 이슈를 알아채지 못했을까요?</p>\n<p>root store는 환경 설정시 세팅 후, 동작이 잘 되는 한 거의 살펴보지 않게 되는 경향이 있죠. 또한 개발 초기에는 store에 들어간 데이터의 정합성에 대해 크게 신경쓸 필요가 없었을 겁니다. 데이터가 타입대로 잘 들어가지만 하면 된거죠(?!) 대부분 fetch가 주가 되었고, 새로고침을 하더라도 저장되어있는 데이터가 그대로 잘 나타나니 알아차릴 방법이 없었을 겁니다.</p>\n<p>makeStore 메서드 내에 변수로 존재해야 할 root store를 밖으로 꺼내놨으니, 싱글 스레드인 Node에서 store에 저장된 데이터가 지속적으로 유지 되었을 것이고, 새롭게 init되는 과정이 없어진 것이었습니다. 가이드처럼 makeStore를 재구성해주면 해결될 문제인 것으로 판단되었습니다.</p>\n<p>fetch가 아닌 post/put/delete의 동작을 실행하게 되니, 바로 이슈를 알아차릴 수 있었... 다면 얼마나 좋았을까요 ㅠㅠ</p>\n<h3 id=\"2-과정\" style=\"position:relative;\">2. 과정<a href=\"#2-%EA%B3%BC%EC%A0%95\" aria-label=\"2 과정 permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>사실 원인에 간단히 써놓은 것과 다르게 원인을 파악하는 데에만 하루정도의 시간이 소요되었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1. nextjs 서비스를 새로 실행한다.\n2. 브라우저 접속 시 getServerSideProps를 통해 redux의 action 및 fetch가 실행되고 store에 데이터가 저장된다.\n3. 새로고침을 한다.\n4. redux action은 실행되지만 업데이트가 안됨\n5. 왜???</code></pre></div>\n<p>수없이 많은 로그를 찍어보았으나, 의심가는 곳은 한 두 곳이 아니었습니다.</p>\n<ol>\n<li>reselect</li>\n<li>\n<p>reselect로 가져오는 데이터가 데이터를 캐싱하는걸까?</p>\n<ul>\n<li>하지만, client 레벨의 reselect가 새로고침하는 과정까지 데이터를 들고있을 순 없지...</li>\n</ul>\n</li>\n<li>next.js\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 480px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a9680dd1baf217c83d9b15ce5cb24bfc/efb68/action-log.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 89.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAACa0lEQVR42mVUWbKiQBDkHCPN1i0Iguy4gRrv98Xc/zg1lQXNoH5UiHSSlVlLO1GkqWkaKoqCDoeU40BhGJHyPAnXdel0OvG7kPwgoKqqOGpK01TwWmvygFVzOAAlSUL3+53O5zP1fU9d1wmxUkoISyaJoogCxoIAuOv1KlhEnueCBbEDUBzHAgAwyzIK+WMczpkVK/XJ831W+U4IV1ahxTqwkrKakRUCBHLJtmQUQg7f90SlMYbut5s4Oh6P6/mqEPWK2fI4PajmWmr+YMc2XZftqjlmQl/URBw3JuuGQdxYolVhwFnLeE8/Q0djW1OhI46Qco4iZBLlCikI0cCjiejJuLGpRfGWcFbIoCo29NPV9OoaGrKE2sRQw+8aE5LxNoSsLueEr6aie1nI/y9CqQuawnW5XC5Soz+7nXQXRDvlvVlGw6QpqCF3F7h3hVzDlC1PlzOd24byQ0IGDWAS7Smx7EPFotCghn0nUeVHmc2tSsfnjD1b/B0aeuYpjWlMUzYHnsdEU8y2LWHGlv8K9kBtyE3bqFstJzw2PXcNXd6zfenssilq6Z4dapQE2IK3B9OxHRvpMgj3+z3dltnCr51F1M2Owzo2Sw3HcaRpmtZZtNhZIWfCUA+cuW1b2QDMmGwNDz4KbwmhEITAYkWxdiBF4MzBbEEh1CFrXddyECzFVp+DzQIwDY/HY01u936xrMXiOE5CiMxlWa5D+0mIgNXn87leEHDxtnrI8Hq9VhBUqq9d/k8IhfamwdWGq8w6cjCoeGEPLQBJtoR4RilQbwQSfG6JKNTazBuwFB+xJdk+AxPwFeYp74vIxj/jegk3n+9LtAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"action-log\"\n        title=\"action-log\"\n        src=\"/static/a9680dd1baf217c83d9b15ce5cb24bfc/e85cb/action-log.png\"\n        srcset=\"/static/a9680dd1baf217c83d9b15ce5cb24bfc/070ae/action-log.png 120w,\n/static/a9680dd1baf217c83d9b15ce5cb24bfc/8ff5a/action-log.png 240w,\n/static/a9680dd1baf217c83d9b15ce5cb24bfc/e85cb/action-log.png 480w,\n/static/a9680dd1baf217c83d9b15ce5cb24bfc/37523/action-log.png 720w,\n/static/a9680dd1baf217c83d9b15ce5cb24bfc/d9199/action-log.png 960w,\n/static/a9680dd1baf217c83d9b15ce5cb24bfc/efb68/action-log.png 2032w\"\n        sizes=\"(max-width: 480px) 100vw, 480px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>애매하다... 위 이미지와 같은 로그가 생기긴 했는데, 저 url은 언제 바뀐거지..?</li>\n<li><code class=\"language-text\">/_next/data/development/index.json</code>에 데이터가 저장되어 있음. 음... 이 로그는 refresh 가 안되나...?</li>\n<li>\n<p>문서에 따로 저장해서 그걸 지속적으로 활용한다는 말이 없음...</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">When you request this page on client-side page transitions through next/link (documentation),\nNext.js sends an API request to server, which runs getServerSideProps.\nIt’ll return a JSON that contains the result of running getServerSideProps,\nand the JSON will be used to render the page. (https://nextjs.org/docs/basic-features/data-fetching)</code></pre></div>\n</li>\n<li>redux-saga</li>\n<li>\n<p>takeLatest, takeEvery 문제?</p>\n<ul>\n<li>바꿔바도 문제 없음</li>\n<li>문제가 된다면 action 로그도 안찍혔겠지...</li>\n</ul>\n</li>\n<li>next-redux-wrapper</li>\n<li>음.... 심증만 있고 물증이 없다...</li>\n</ol>\n<h3 id=\"3-해결\" style=\"position:relative;\">3. 해결<a href=\"#3-%ED%95%B4%EA%B2%B0\" aria-label=\"3 해결 permalink\" class=\"autolink-headers-- after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>역시나 믿을건 구글링 밖에 없었고, 결국 구글링으로 <a href=\"https://github.com/vercel/next.js/discussions/15954\" target=\"_blank\" rel=\"noopener\">동일한 이슈를 가진 discussion</a>을 찾게 되었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">The first was that the store that we were using with next-redux-wrapper was defined globally const, instead of internally within makeStore...</code></pre></div>\n<p>이슈 해결에 대한 얘기의 바로 첫 문장에서 아차 하는 마음이 들었습니다;; 바로 root store의 global한 store 구성을 제거하였고, 새로고침 시 데이터가 제대로 fetch 됨을 확인할 수 있었습니다.</p>\n<p>이를 위해 <code class=\"language-text\">IAppDispatch</code>를 포기하게 되었지만, 사용에 문제가 없었기에 기능을 우선시 할 수밖에 없었습니다.</p>\n<hr>\n<p>해결에 하루 넘게 걸린 이슈도 막상 해결하고 정리하면 간단하게 끝나지만, 뿌듯함은 이루 말할수가 없네요 :)</p>","frontmatter":{"title":"next-redux-wrapper 설정 이슈","date":"February 05, 2021","tags":["next.js","react","typescript"]}}},"pageContext":{"slug":"/posts/next-redux-wrapper-settings","previous":{"fields":{"slug":"/posts/why-typescript"},"frontmatter":{"title":"Why typescript?"}},"next":{"fields":{"slug":"/posts/react-reconciliation"},"frontmatter":{"title":"React Advanced guides > Reconciliation"}}}},"staticQueryHashes":["1576648375","1963346411"]}