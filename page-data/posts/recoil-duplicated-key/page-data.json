{"componentChunkName":"component---src-templates-post-template-tsx","path":"/posts/recoil-duplicated-key","result":{"data":{"site":{"siteMetadata":{"title":"June"}},"markdownRemark":{"id":"196edabb-c0f6-5c97-ac64-8b68e3471258","excerpt":"recoil을 사용해서 개발하다 보면 쉽게 마주칠 수 있는 warning이 있습니다.\n바로  라는 warning 메세지 인데요,\nHMR에서 발생한다곤 하지만, 꽤나 긴 메세지가 계속 콘솔을 채우고 있는걸 보자니\n상당히 거슬립니다. 원인을 찾아 수정 해줘야겠습니다.  warning…","html":"<p>recoil을 사용해서 개발하다 보면 쉽게 마주칠 수 있는 warning이 있습니다.\n바로 <code class=\"language-text\">Duplicate atom key &quot;...&quot;</code> 라는 warning 메세지 인데요,\nHMR에서 발생한다곤 하지만, 꽤나 긴 메세지가 계속 콘솔을 채우고 있는걸 보자니\n상당히 거슬립니다. 원인을 찾아 수정 해줘야겠습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 480px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9636b0c268fe5e5c5682fe967bb43ae6/6e7c1/error.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.666666666666668%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAEABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAEDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAc6ArB//xAAWEAADAAAAAAAAAAAAAAAAAAAAARD/2gAIAQEAAQUCjP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABgQAQEAAwAAAAAAAAAAAAAAAAEAITFx/9oACAEBAAE/ITRPIZv/2gAMAwEAAgADAAAAEAPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhAAAgIDAAAAAAAAAAAAAAAAAREAITFxsf/aAAgBAQABPxC7wMRWkWoAU5P/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"error\"\n        title=\"error\"\n        src=\"/static/9636b0c268fe5e5c5682fe967bb43ae6/7cc5e/error.jpg\"\n        srcset=\"/static/9636b0c268fe5e5c5682fe967bb43ae6/e439a/error.jpg 120w,\n/static/9636b0c268fe5e5c5682fe967bb43ae6/09b79/error.jpg 240w,\n/static/9636b0c268fe5e5c5682fe967bb43ae6/7cc5e/error.jpg 480w,\n/static/9636b0c268fe5e5c5682fe967bb43ae6/80e3c/error.jpg 720w,\n/static/9636b0c268fe5e5c5682fe967bb43ae6/6a068/error.jpg 960w,\n/static/9636b0c268fe5e5c5682fe967bb43ae6/6e7c1/error.jpg 1750w\"\n        sizes=\"(max-width: 480px) 100vw, 480px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<hr>\n<p>warning이 발생하는 원인부터 알아야겠습니다.</p>\n<p>메세지에 있는 것처럼 HMR, 즉 유저의 파일 수정으로 인해 HMR을 통한 업데이트가 있을 때\n기존에 정의해둔 Recoil의 atom이 재정의 되면서 키가 중복되는 상태가 되는 것입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// 아주 기본적인 atom. 보통 global한 modal, popup을 위해 사용</span>\n<span class=\"token operator\">...</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> atom <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'recoil'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> modalState <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">atom</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>IModalType <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  key<span class=\"token operator\">:</span> <span class=\"token string\">'modalState'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<p>에러에 대한 <a href=\"https://github.com/facebookexperimental/Recoil/issues/733\" target=\"_blank\" rel=\"noopener\">issue</a>는 금방 찾을 수 있었는데요, 20년도 11월 (2년전...)부터 있었던 이슈니 꽤 오래되었습니다.</p>\n<p>공식적인 해결책은 없었고, 얼기설기 유저들이 테스트하며 해결하는 방법밖엔 없었습니다.\n가장 깔끔했던 방법은 uuid 라이브러릴 통해 key값을 항상 다르게 만들어 주는 방법이었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> atom <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'recoil'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> v1 <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'uuid'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> modalState <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">atom</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>IModalType <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  key<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">modalState/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">v1</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">default</span><span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<hr>\n<p>진행중이던 프로젝트가 적절히 마무리되고 동일한 메세지 때문에 한번 더 github issue를 확인하다 보니\n2년만에...! 버그픽스가 되었다고 <a href=\"https://github.com/facebookexperimental/Recoil/releases/tag/0.7.6\" target=\"_blank\" rel=\"noopener\">0.7.6 릴리즈노트</a>가 갱신되었다고 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1. recoil 패키지에서 RecoilEnv를 import 하고\n&quot;RecoilEnv.RECOIL_DUPLICATE_ATOM_KEY_CHECKING_ENABLED = false&quot;\n설정을 해준다.\n\n2. nextjs와 같은 nodejs 환경에서\n&quot;process.env.RECOIL_DUPLICATE_ATOM_KEY_CHECKING_ENABLED=false&quot;\n와 같이 설정해줘도 된다.\n\n* 참고로 정상적인 Duplicate atom key도 포함하여 모든 키갱신 에러를 체크하지 않음.</code></pre></div>\n<hr>\n<p>그리 중요하지 않은 내용이지만... 2년에 걸려 애써 무시하던 warning 메세지가가\n공식적으로 해결할 수 있게 된것이 기뻐 기록으로 남겨봅니다</p>","frontmatter":{"title":"Recoil duplicate key error","date":"December 11, 2022","tags":["react","recoil","error"]}}},"pageContext":{"slug":"/posts/recoil-duplicated-key","previous":{"fields":{"slug":"/posts/i18next"},"frontmatter":{"title":"i18next in react"}},"next":null}},"staticQueryHashes":["1576648375","1963346411"]}